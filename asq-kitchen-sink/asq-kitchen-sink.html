<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/components/font-roboto/roboto.html">
<link rel="import" href="/components/core-elements/core-elements.html">
<link rel="import" href="/components/paper-elements/paper-elements.html">

<link rel="import" href="/asq-elements.html">

<polymer-element name="asq-kitchen-sink" attributes="label" >
<template>
  <link rel="stylesheet" href="./css/asq-kitchen-sink.css" type="text/css" />
  <section fullbleed layout horizontal fit>
    <section id="element-menu-placeholder" ></section>
    <nav id="element-menu-nav" layout vertical >
      <h3 id="element-menu-header">{{label}}</h3>
      <section id="element-menu-container" flex relative>
        <core-menu selected="0" id="element-menu" on-core-select="{{elementSelect}}" fit>  
          <template repeat="{{elem in elems}}">
            <core-item label="{{elem.name}}" tag="{{elem.name}}" url="{{elem.url}}"></core-item>
          </template>
        </core-menu>
      </section>
    </nav>
    <core-header-panel mode="seamed" id="main-panel" flex layout horizontal>
      <core-toolbar id="toolbar">

        <span flex> <!-- 1/3 width-->
          <paper-icon-button id="hamburger" icon="menu" title="menu" role="button" tabindex="0" aria-label="menu" touch-action="pan-x pan-y" on-click="{{menuClick}}"></paper-icon-button>

          <img style="height:30px;" src="../img/asq-logo.png">
        </span>

        <core-menu id="role-panel-tabs" noink role="tablist" on-core-select="{{roleSelect}}" flex horizontal center layout multi><!-- 2/3 width -->
        
          <core-item data-target="presenter-section" inline flex center-center horizontal layout>Presenter</core-item>
          <core-item data-target="viewer-section" inline flex center-center horizontal layout>Viewer</core-item>
          <core-item data-target="ta-section" inline flex center-center horizontal layout >Teaching Assistant</core-item>
          
      </core-menu>
        <span flex></span> <!-- 3/3 width-->
        
      </core-toolbar>


      <section id="main" horizontal layout fit >
        <section class="role-section" id="presenter-section" flex>
          <span class="role-name">Presenter</span>
          <div id="pframeContainer">
            <iframe id="pframe" class="frame" on-load="{{frameLoaded}}"></iframe>
          </div>
        </section>

        <section class="role-section" id="viewer-section" flex layout vertical self-stretch>
         <span class="role-name">Viewer</span>
          <div id="vframeContainer">
            <iframe id="vframe" class="frame" on-load="{{frameLoaded}}"></iframe>
          </div>
        </section>

        <section class="role-section" id="ta-section" flex layout vertical self-stretch>
         <span class="role-name">Teaching Assistant</span>
          <div id="tframeContainer">
            <iframe id="tframe" class="frame" on-load="{{frameLoaded}}"></iframe>
          </div>
        </section>
      </section>
    </core-header-panel>

</section>
</template>

  <script>
    Polymer({
      item: undefined,
      elems: [
        {name: "asq-code"},
        {name: "asq-css-select"},
        {name: "asq-exercise"},
        {name: "asq-js-function-body"},
        {name: "asq-multi-choice"},
        {name: "asq-option"},
        {name: "asq-stem"},
        {name: "asq-text-input"}
      ],

      created: function () {
        this.elems.forEach(function(elem, index){
          elem.url = "/asq/" + elem.name + "/demo.html"
        }); 
      },

      domReady: function() {
        //hide role panels
        this.shadowRoot.querySelectorAll('.role-section').array().forEach(function(elem) {
          elem.style.display = "none";
        });
        this.shadowRoot.getElementById('role-panel-tabs').selected = ["0","1"];
        
      },

      roleSelect: function(e, detail, target) {
        //setup toggling behavior
        this.shadowRoot.getElementById(detail.item.dataset.target).style.display = detail.isSelected ? "block" : "none";
      },

      elementSelect: function(e, detail) {
        if (detail.isSelected) {
          this.item = detail.item;
          if (this.item.children.length) {
            this.item.selected = 0;
          }
          this.item.tag = this.item.getAttribute('tag');
          var url = this.item.getAttribute('url');
          window.location.hash = this.item.tag;

          this.$.pframe.contentWindow.location.replace(url);
          this.$.vframe.contentWindow.location.replace(url);
          this.$.tframe.contentWindow.location.replace(url);
        }
      },

      frameLoaded: function() {
        if (!this.item) {
          return;
        }
        this.$.pframe.contentWindow.addEventListener('polymer-ready', function() {
          this.$.pframe.contentWindow.postMessage({role: "presenter"}, "*");
          this.$.vframe.contentWindow.postMessage({role: "viewer"}, "*");
          this.$.tframe.contentWindow.postMessage({role: "ta"}, "*");
        }.bind(this));

      },

      // doesn't work
      menuClick: function(e, detail) {
        console.log(this.shadowRoot.querySelector("#element-menu-placeholder"));
        console.log(this.shadowRoot.querySelector("#element-menu-nav"));
        this.shadowRoot.querySelector("#element-menu-placeholder").classList.toggle('menu-open');
        this.shadowRoot.querySelector("#element-menu-nav").classList.toggle('menu-open');

      }
    });

    </script>

</polymer-element>
