<link rel="import" href="../asq-option/asq-option.html">
<link rel="import" href="../asq-multi-choice/asq-multi-choice.html">
<link rel="import" href="../asq-stem/asq-stem.html">
<link rel="import" href="../asq-text-input/asq-text-input.html">
<link rel="import" href="../asq-code/asq-code.html">
<link rel="import" href="../asq-css-select/asq-css-select.html">
<link rel="import" href="../asq-js-function-body/asq-js-function-body.html">
<link rel="import" href="../asq-confidence/asq-confidence.html">
<link rel="import" href="../asq-progress/asq-progress.html">

<link rel="import" href="../../components/paper-button/paper-button.html">

<link rel="import" href="../asq-shared-mixin.html">


<polymer-element name="asq-exercise" attributes="exerciseid" >
  <template>
    <style> 

      :host{
        display: block;
      }
   
      .submit_button {
        color: #fff;
        background-color: #5cb85c;
        /*border-color: #4cae4c;*/
      }
      .edit_button {
        background-color: rgb(255, 155, 15);
      }

      div {
        margin-left: 2em;
        margin-right: 2em;
      }

      footer {
       /* position:absolute;
        bottom: 1em;
        right: 1em;
        text-align: right;*/
      }
     
    </style>

    <template if="{{role=='viewer'}}">
      <article id="ex" class="asq-exercise">
        <div>
          <content select="asq-stem"></content>
        </div>
        <div id="exercises">
          <content></content>
        </div>
        <footer id="buttons" horizontal end-justified layout>
          <div>
            <asq-confidence id="confidence"></asq-confidence>
            <paper-button is="paper-button" class="submit_button" id='submitbutton{{exerciseid}}' on-click="{{submit}}">Submit</paper-button>
            <paper-button is="paper-button" class="edit_button" id="editbutton{{exerciseid}}">Edit</paper-button> 
          </div>   
        </footer>
      </article>
    </template>


    <template if="{{role=='presenter'}}">
      <article id="ex" class="asq-exercise">
        <div>
          <content select="asq-stem"></content>
        </div>
        <div id="exercises">
          <content></content>
        </div>
        <footer id="buttons" horizontal end-justified layout>
          <div>
            <asq-progress></asq-progress>
            <paper-button is="paper-button" class="submit_button">Stats</paper-button>
          </div>
        </footer>
      </article>
    </template> 

  </template>

  <script>
    (function() {
      var isASQElement_ = true;
      var isQuestion_ = true;
      var type_ = "asq-exercise";

      Polymer('asq-exercise', Polymer.mixin({
        exerciseid: 0,

        publish: {
          role: "viewer",
        },

        submit: function() {
          if ( this.role !== "viewer" ) {
            return;
          }

          var questions = this.childNodes.array().filter(function(el) {
            return el.isASQElement && el.isQuestion;
          });

          console.log("questions ", questions);

          var submisstion = [];
          questions.forEach(function(elem, index) {
            console.log(index, elem.hello);
            submisstion.push(elem.collectAnswer());
          });

          var confidence = this.$.confidence.getConfidenceLevel();

          var a = {
            question: this.exerciseid,
            submisstion: submisstion,
            confidence: confidence
          }

          console.log("SUMMISSION", a);
          return a;
        },

        ready: function() {

        },

        get isASQElement() {
          return isASQElement_;
        },

        get isQuestion() {
          return isQuestion_;
        },

        get type() {
          return type_;
        }

      }), asqSharedMixin);

    })();
  </script>
</polymer-element>